SVM(Hard Margin) vs Soft Margin SVM
================
Changhyun Kim
2022-10-25

### 1. SVM에서 Soft and Hard Margin이란?

기본적으로 SVM은 선형으로 분리(Linearly Separable)된다고 가정한다.

하지만, 현실에서 선형으로 완벽히 분리가 되는 데이터는 찾아보기 어렵다.
따라서 SVM은 데이터의 오분류(error)를 허용해준다.

그렇지만 무분별하게 오분류를 허용하게 되면 classifier로써의 역할은
사라지게 때문에, SVM에서는 $C$ 라는 하이퍼파라미터를 통해 error를 얼마나
허용해 줄 것인지 정해준다. (하단의 수식 참고)

이때 error를 허용해주지 않는 경우를 Hard Margin SVM이라고 하는데 이는
사실 데이터를 선형으로 분리하는 SVM과 같다.

다음으로, error를 $C$값에 따라 어느정도 허용해주는 SVM은 Soft Margin SVM
이라고 한다.

해당 듀토리얼에서는 $C$ 값에 따른 SVM의 종류 (Hard Margin, Soft
Margin)을 알아보고, C 값에 따른 Soft Margin SVM의 변화를 알아보고자
한다.

또한 Hard Margin SVM과 Soft Margin SVM의 실제 Support Vector가 어떻게
생성되는지 알아보고자 한다.

### 2. Hard Margin SVM(Lineary Separable SVM)

일반 SVM(Hard Margin SVM) 모델의 랑그랑지안 Primal 식과 Dual 식은 아래와
같다.

<img src="image/hardmarginsvm.PNG" data-fig.align="center" />

### 3. Soft Margin SVM(SVM with Error)

Soft Margin SVM 모델의 랑그랑지안 Primal 식과 Dual 식은 아래와 같다.

<img src="image/softmarginsvm.PNG" data-fig.align="center" />

해당 식에는 위(Hard Margin)에는 식에는 없는 $C$ 가 존재하는데, 이는 뒤에
**error(**$\epsilon_i$)를 얼마나 식에 반영할지 정하는 하이퍼
파라미터이다.

그런데, Hard Margin SVM과 Soft Margin SVM의 Dual식의 제약조건을 보면,

Soft Margin SVM에서 $a_i$가 $c$ 이하가 된다는 조건 이외에 두 식이 **모두
동일**함을 알 수 있다.

또한, 만약 Soft Margin SVM의 $c$가 $\infty$로 커지면 $c$ 이하가된다는
조건은 무의미해짐을 알 수 있다.

이런 경우 수식 상 Hard Margin과 Soft Margin SVM이 완벽히 같아짐을 알 수
있다.

그리고 만약 $c$가 매우 작아지면(0) **error**의 영향이 매우
작아지기 때문에 모든 error를 허용할 것이라고 예상할 수 있다.

(primal은 minimize 문제이기 때문에 $+C$가 0이되면 error의 영향이
무의미해짐 )

따라서 이후에는 다음과 같은 방법을 따라 실제로 Soft Margin SVM의 $c$가
$\infty$로 커지면 정말 Hard Margin SVM과 같아지는지 확인하고, $c$가 매우
작은 경우의 결과도 확인해 볼 예정이다.

1.  Linearly Saparable한 데이터를 생성한다.
2.  Soft Margin SVM의 $C$ 값이 아주 큰 경우($\infinity$)를 설정하고
    데이터를 분리한다.
3.  Soft Margin이지만 $C$가 아주 크게 되면 이론상 Hard Margin과
    같아짐으로 데이터를 선형분리 할 수 있다.
4.  이때의 $w$ 값을 알아본다.
5.  추가적으로 $c$가 매우 작은 경우를 설정하고
6.  이때의 $w$ 값을 알아본다.

### Linearly Saparable한 데이터를 생성한다.

``` r
library(MASS)
library(e1071)
```

``` r
n1 <- n2 <- 50 # 데이터 50개
m1 <- c(1.5,1) # 다변수정규분포1 평균 
m2 <- c(-2,-2) # 다변수정규분포2 평균

v1 <- v2 <- diag(2) # 0,1 설정
x1 <- mvrnorm(n1, m1, v1) # 다변수정규분포1
x2 <- mvrnorm(n2, m2, v2) # 다변수정규분포2

# linearly separable한 데이터 생성
plot(x1[,1],x1[,2],col=2,xlim=c(-4,4),ylim=c(-4,4)) # x1 data plot
points(x2[,1],x2[,2],col=3) # x2 data plot
```

![](Hard-Margin-SVM-vs-Soft-Margin-SVM_files/figure-gfm/unnamed-chunk-2-1.png)<!-- -->

### 생성된 데이터 확인

``` r
# dataframe check
dat <- data.frame(cbind(rep(c(0,1),each=n1),rbind(x1,x2))) # x1=0, x2=1
colnames(dat) <- c("y","z1","z2")
dat
```

    ##     y          z1           z2
    ## 1   0  0.14355668  1.550818231
    ## 2   0  0.39671409  0.159849311
    ## 3   0  1.49470776  0.800088317
    ## 4   0  3.27532981  3.331100644
    ## 5   0 -0.14951772  0.581423326
    ## 6   0  2.35411083  0.527786716
    ## 7   0  1.25881446  0.185918295
    ## 8   0  2.05494140  0.266415324
    ## 9   0  1.24360692  0.966118573
    ## 10  0  1.84342729  0.716192679
    ## 11  0  0.83312052  2.103798495
    ## 12  0  5.10365195  0.155826038
    ## 13  0  1.08609015  0.001501233
    ## 14  0  1.23287865  0.805298983
    ## 15  0  3.50354476  0.284199448
    ## 16  0  0.96062775  1.956748583
    ## 17  0  2.28546285  0.182545582
    ## 18  0  1.55305877  1.016348338
    ## 19  0 -0.13152297  0.902962179
    ## 20  0  2.18396439  0.984205977
    ## 21  0  1.40110340  0.018440691
    ## 22  0  1.21852208  1.906594319
    ## 23  0  0.47802851 -1.290978080
    ## 24  0  0.12248139  1.139566320
    ## 25  0  1.44036692  0.418002819
    ## 26  0  1.04421434  0.619515298
    ## 27  0  0.81967866 -0.233062215
    ## 28  0  3.28597972  2.084809975
    ## 29  0  1.10828684  0.981218603
    ## 30  0  0.51656244  1.299653505
    ## 31  0  3.06888616  0.461946830
    ## 32  0  1.88719694  1.519445404
    ## 33  0  2.09214066  0.724005134
    ## 34  0 -0.04914382  0.365914788
    ## 35  0  0.92976560 -0.037653160
    ## 36  0  1.39504694  0.785464829
    ## 37  0  2.29592755  0.605435468
    ## 38  0  2.44482222  0.821937442
    ## 39  0  0.97262184  0.448243854
    ## 40  0  1.42637114  2.659952310
    ## 41  0  1.84715549  1.346936609
    ## 42  0  1.01019678  0.811231766
    ## 43  0  1.73614027  2.339422234
    ## 44  0  2.38036956  2.449564223
    ## 45  0  3.52976455  0.623686162
    ## 46  0  1.65353440 -0.039255142
    ## 47  0  1.63607560 -0.357558195
    ## 48  0  2.09368569 -0.078533673
    ## 49  0  1.36957381  2.777344331
    ## 50  0  1.69731450  0.723891784
    ## 51  1 -1.51049545 -1.431861932
    ## 52  1 -3.27185672 -0.370515993
    ## 53  1 -2.88547741 -1.686832311
    ## 54  1 -1.97624719 -3.010498724
    ## 55  1 -3.33350907 -4.536173871
    ## 56  1 -2.28589463 -0.230739813
    ## 57  1 -0.38314040 -1.509218845
    ## 58  1 -2.50962375 -2.085851709
    ## 59  1 -4.10128796 -2.199880525
    ## 60  1 -1.59513516 -2.413707460
    ## 61  1 -1.11945301 -1.939352439
    ## 62  1 -3.63169747 -2.042736409
    ## 63  1 -1.36486936 -1.486370863
    ## 64  1 -1.89990365 -2.334063698
    ## 65  1 -1.24432644 -3.340407103
    ## 66  1 -3.35947701 -2.063261177
    ## 67  1 -2.69231323 -3.459723356
    ## 68  1 -1.85322923 -1.643981609
    ## 69  1 -0.23935958 -2.874719571
    ## 70  1 -2.94979718 -2.112598293
    ## 71  1 -2.35048838 -1.948033387
    ## 72  1 -1.30770262 -1.149615549
    ## 73  1 -3.32637333 -2.598582722
    ## 74  1 -2.30576555 -0.501726774
    ## 75  1 -2.14838216 -2.484319644
    ## 76  1 -0.76359969 -0.777318292
    ## 77  1 -1.34632035 -2.175857500
    ## 78  1 -1.62770969 -0.234279388
    ## 79  1 -1.17185226 -0.554281151
    ## 80  1  0.19994894 -3.305376452
    ## 81  1 -1.72658136 -2.604634812
    ## 82  1 -0.67537855 -2.777905138
    ## 83  1 -2.12348921 -2.350470930
    ## 84  1 -1.51181433 -3.584984608
    ## 85  1 -2.78321042 -1.562905514
    ## 86  1 -0.61355609 -3.368918632
    ## 87  1  0.12329805 -1.208170153
    ## 88  1 -0.46879318 -2.288764829
    ## 89  1 -1.59794326 -1.781542442
    ## 90  1 -1.83992433 -1.105087223
    ## 91  1 -0.84394935 -2.812163197
    ## 92  1 -3.79883587 -1.975323567
    ## 93  1 -1.16673151 -0.197736986
    ## 94  1 -3.57643634 -3.727643506
    ## 95  1 -2.04237829 -2.392027354
    ## 96  1 -1.60030200 -2.765200666
    ## 97  1 -2.96384346 -1.989882001
    ## 98  1 -0.44802501 -2.772119383
    ## 99  1 -1.42689164 -1.759963623
    ## 100 1 -0.69389305 -2.465404495

### Soft Margin SVM의 $C$ 값이 아주 큰 경우($\infty$)를 설정

``` r
# Soft Margin with Large C
model_largec <- svm(as.factor(y)~.,kernel="linear",cost=10e15, data=dat) 
summary(model_largec)
```

    ## 
    ## Call:
    ## svm(formula = as.factor(y) ~ ., data = dat, kernel = "linear", cost = 1e+16)
    ## 
    ## 
    ## Parameters:
    ##    SVM-Type:  C-classification 
    ##  SVM-Kernel:  linear 
    ##        cost:  1e+16 
    ## 
    ## Number of Support Vectors:  3
    ## 
    ##  ( 2 1 )
    ## 
    ## 
    ## Number of Classes:  2 
    ## 
    ## Levels: 
    ##  0 1

``` r
predict(model_largec,dat[,-1])
```

    ##   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20 
    ##   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0 
    ##  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40 
    ##   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0 
    ##  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60 
    ##   0   0   0   0   0   0   0   0   0   0   1   1   1   1   1   1   1   1   1   1 
    ##  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80 
    ##   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1 
    ##  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100 
    ##   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1 
    ## Levels: 0 1

### Soft Margin이지만 $C$가 아주 크게 되면 실제로 Hard Margin과 같아짐을 확인

### (=선형 분리됨)

``` r
plot(model_largec,dat)
```

![](Hard-Margin-SVM-vs-Soft-Margin-SVM_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

### 이때의 $w$ 값 확인(Support Vector가 존재함)

``` r
model_largec$coefs 
```

    ##            [,1]
    ## [1,]   7.013346
    ## [2,]  75.671006
    ## [3,] -82.684352

### 추가적으로 $c$가 매우 작은 경우를 설정

``` r
model_smallc <- svm(as.factor(y)~.,kernel="linear",cost=10e-15, data=dat) # c가 없는경우(cost=10e-15)으로 큰 경우
summary(model_smallc)
```

    ## 
    ## Call:
    ## svm(formula = as.factor(y) ~ ., data = dat, kernel = "linear", cost = 1e-14)
    ## 
    ## 
    ## Parameters:
    ##    SVM-Type:  C-classification 
    ##  SVM-Kernel:  linear 
    ##        cost:  1e-14 
    ## 
    ## Number of Support Vectors:  100
    ## 
    ##  ( 50 50 )
    ## 
    ## 
    ## Number of Classes:  2 
    ## 
    ## Levels: 
    ##  0 1

``` r
predict(model_smallc,dat[,-1])
```

    ##   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20 
    ##   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0 
    ##  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40 
    ##   0   0   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0 
    ##  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60 
    ##   0   0   0   0   0   0   0   0   0   0   1   1   1   1   1   1   1   1   1   1 
    ##  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80 
    ##   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1 
    ##  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100 
    ##   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1 
    ## Levels: 0 1

### Soft Margin에서 $C$가 아주 작은 경우 확인

### (=선형 분리되는 것 처럼 보임)

``` r
plot(model_smallc,dat)
```

![](Hard-Margin-SVM-vs-Soft-Margin-SVM_files/figure-gfm/unnamed-chunk-8-1.png)<!-- -->

### 이때의 $w$ 값 확인

### (모든 점이 support vector가 됨 = w가 전부 0 = 의미없음)

``` r
model_smallc$coefs
```

    ##          [,1]
    ##   [1,]  1e-14
    ##   [2,]  1e-14
    ##   [3,]  1e-14
    ##   [4,]  1e-14
    ##   [5,]  1e-14
    ##   [6,]  1e-14
    ##   [7,]  1e-14
    ##   [8,]  1e-14
    ##   [9,]  1e-14
    ##  [10,]  1e-14
    ##  [11,]  1e-14
    ##  [12,]  1e-14
    ##  [13,]  1e-14
    ##  [14,]  1e-14
    ##  [15,]  1e-14
    ##  [16,]  1e-14
    ##  [17,]  1e-14
    ##  [18,]  1e-14
    ##  [19,]  1e-14
    ##  [20,]  1e-14
    ##  [21,]  1e-14
    ##  [22,]  1e-14
    ##  [23,]  1e-14
    ##  [24,]  1e-14
    ##  [25,]  1e-14
    ##  [26,]  1e-14
    ##  [27,]  1e-14
    ##  [28,]  1e-14
    ##  [29,]  1e-14
    ##  [30,]  1e-14
    ##  [31,]  1e-14
    ##  [32,]  1e-14
    ##  [33,]  1e-14
    ##  [34,]  1e-14
    ##  [35,]  1e-14
    ##  [36,]  1e-14
    ##  [37,]  1e-14
    ##  [38,]  1e-14
    ##  [39,]  1e-14
    ##  [40,]  1e-14
    ##  [41,]  1e-14
    ##  [42,]  1e-14
    ##  [43,]  1e-14
    ##  [44,]  1e-14
    ##  [45,]  1e-14
    ##  [46,]  1e-14
    ##  [47,]  1e-14
    ##  [48,]  1e-14
    ##  [49,]  1e-14
    ##  [50,]  1e-14
    ##  [51,] -1e-14
    ##  [52,] -1e-14
    ##  [53,] -1e-14
    ##  [54,] -1e-14
    ##  [55,] -1e-14
    ##  [56,] -1e-14
    ##  [57,] -1e-14
    ##  [58,] -1e-14
    ##  [59,] -1e-14
    ##  [60,] -1e-14
    ##  [61,] -1e-14
    ##  [62,] -1e-14
    ##  [63,] -1e-14
    ##  [64,] -1e-14
    ##  [65,] -1e-14
    ##  [66,] -1e-14
    ##  [67,] -1e-14
    ##  [68,] -1e-14
    ##  [69,] -1e-14
    ##  [70,] -1e-14
    ##  [71,] -1e-14
    ##  [72,] -1e-14
    ##  [73,] -1e-14
    ##  [74,] -1e-14
    ##  [75,] -1e-14
    ##  [76,] -1e-14
    ##  [77,] -1e-14
    ##  [78,] -1e-14
    ##  [79,] -1e-14
    ##  [80,] -1e-14
    ##  [81,] -1e-14
    ##  [82,] -1e-14
    ##  [83,] -1e-14
    ##  [84,] -1e-14
    ##  [85,] -1e-14
    ##  [86,] -1e-14
    ##  [87,] -1e-14
    ##  [88,] -1e-14
    ##  [89,] -1e-14
    ##  [90,] -1e-14
    ##  [91,] -1e-14
    ##  [92,] -1e-14
    ##  [93,] -1e-14
    ##  [94,] -1e-14
    ##  [95,] -1e-14
    ##  [96,] -1e-14
    ##  [97,] -1e-14
    ##  [98,] -1e-14
    ##  [99,] -1e-14
    ## [100,] -1e-14

### 결론

1.  Soft Margin SVM에서 $c$가 $\infinity$가 되면 Hard Margin SVM(SVM)과
    같다.
2.  Soft Margin SVM에서 $c$가 매우 작아지면 최적화 과정에서 error를
    고려하지 않기 때문에 가능하지 않다 (의미없다)
